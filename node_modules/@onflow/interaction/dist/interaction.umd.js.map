{"version":3,"file":"interaction.umd.js","sources":["../src/interaction.js"],"sourcesContent":["export const UNKNOWN /*                 */ = 0b00000001\nexport const SCRIPT /*                  */ = 0b00000010\nexport const TRANSACTION /*             */ = 0b00000100\nexport const GET_TRANSACTION_STATUS /*  */ = 0b00001000\nexport const GET_ACCOUNT /*             */ = 0b00010000\nexport const GET_EVENTS /*              */ = 0b00100000\nexport const GET_LATEST_BLOCK /*        */ = 0b01000000\nexport const PING /*                    */ = 0b10000000\n\nexport const BAD /* */ = 0b01\nexport const OK /*  */ = 0b10\n\nconst IX = `{\n  \"tag\":${UNKNOWN},\n  \"assigns\":{},\n  \"status\":${OK},\n  \"reason\":null,\n  \"payload\":{\n    \"code\":null,\n    \"ref\":null,\n    \"nonce\":null,\n    \"limit\":null\n  },\n  \"bounds\":{\n    \"start\":null,\n    \"end\":null\n  },\n  \"acct\":null,\n  \"proposer\":null,\n  \"authz\":[],\n  \"payer\":null,\n  \"eventType\":null,\n  \"txId\":null,\n  \"isSealed\":null\n}`\n\nconst KEYS = new Set(Object.keys(JSON.parse(IX)))\n\nexport const interaction = () => JSON.parse(IX)\n\nconst isArray = d => Array.isArray(d)\nconst isObj = d => typeof d === \"object\"\nconst isNull = d => d == null\nconst isNumber = d => d === \"number\"\nconst isFn = d => typeof d === \"function\"\n\nexport const isInteraction = ix => {\n  if (!isObj(ix) || isNull(ix) || isNumber(ix)) return false\n  for (let key of KEYS) if (!ix.hasOwnProperty(key)) return false\n  return true\n}\n\nexport const Ok = ix => {\n  ix.status = OK\n  return ix\n}\n\nexport const Bad = (ix, reason) => {\n  ix.status = BAD\n  ix.reason = reason\n  return ix\n}\n\nconst make = wat => ix => {\n  ix.tag = wat\n  return Ok(ix)\n}\n\nexport const makeUnknown /*               */ = make(UNKNOWN)\nexport const makeScript /*                */ = make(SCRIPT)\nexport const makeTransaction /*           */ = make(TRANSACTION)\nexport const makeGetTransactionStatus /*  */ = make(GET_TRANSACTION_STATUS)\nexport const makeGetAccount /*            */ = make(GET_ACCOUNT)\nexport const makeGetEvents /*             */ = make(GET_EVENTS)\nexport const makeGetLatestBlock /*        */ = make(GET_LATEST_BLOCK)\nexport const makePing /*                  */ = make(PING)\n\nconst is = wat => ix => Boolean(ix.tag & wat)\n\nexport const isUnknown /*               */ = is(UNKNOWN)\nexport const isScript /*                */ = is(SCRIPT)\nexport const isTransaction /*           */ = is(TRANSACTION)\nexport const isGetTransactionStatus /*  */ = is(GET_TRANSACTION_STATUS)\nexport const isGetAccount /*            */ = is(GET_ACCOUNT)\nexport const isGetEvents /*             */ = is(GET_EVENTS)\nexport const isGetLatestBlock /*        */ = is(GET_LATEST_BLOCK)\nexport const isPing /*                  */ = is(PING)\n\nexport const isOk /*  */ = ix => Boolean(ix.status & OK)\nexport const isBad /* */ = ix => Boolean(ix.status & BAD)\nexport const why /*   */ = ix => ix.reason\n\nconst hardMode = ix => {\n  for (let key of Object.keys(ix)) {\n    if (!KEYS.has(key))\n      throw new Error(`\"${key}\" is an invalid root level Interaction property.`)\n  }\n  return ix\n}\n\nconst recPipe = async (ix, fns = []) => {\n  ix = hardMode(await ix)\n  if (isBad(ix) || !fns.length) return ix\n  const [hd, ...rest] = fns\n  const cur = await hd\n  if (isFn(cur)) return recPipe(cur(ix), rest)\n  if (isNull(cur) || !cur) return recPipe(ix, rest)\n  if (isInteraction(cur)) return recPipe(cur, rest)\n  throw new Error(\"Invalid Interaction Composition\")\n}\n\nexport const pipe = (...args) => {\n  const [arg1, arg2] = args\n  if (isArray(arg1) && arg2 == null) return d => pipe(d, arg1)\n  return recPipe(arg1, arg2)\n}\n\nconst identity = v => v\n\nexport const get = (ix, key, fallback) => {\n  return ix.assigns[key] == null ? fallback : ix.assigns[key]\n}\n\nexport const put = (key, value) => ix => {\n  ix.assigns[key] = value\n  return Ok(ix)\n}\n\nexport const update = (key, fn = identity) => ix => {\n  ix.assigns[key] = fn(ix.assigns[key], ix)\n  return Ok(ix)\n}\n\nexport const destroy = key => ix => {\n  delete ix.assigns[key]\n  return Ok(ix)\n}\n"],"names":["IX","KEYS","Set","Object","keys","JSON","parse","isArray","d","Array","isNull","isInteraction","ix","isNumber","hasOwnProperty","Ok","status","make","wat","tag","makeUnknown","makeScript","makeTransaction","makeGetTransactionStatus","makeGetAccount","makeGetEvents","makeGetLatestBlock","makePing","is","Boolean","isUnknown","isScript","isTransaction","isGetTransactionStatus","isGetAccount","isGetEvents","isGetLatestBlock","isPing","isBad","recPipe","fns","key","has","Error","hardMode","length","hd","rest","cur","identity","v","reason","assigns","fallback","pipe","args","arg1","arg2","value","fn"],"mappings":"+LAYMA,uVAwBAC,EAAO,IAAIC,IAAIC,OAAOC,KAAKC,KAAKC,MAAMN,KAItCO,EAAU,SAAAC,UAAKC,MAAMF,QAAQC,IAE7BE,EAAS,SAAAF,UAAU,MAALA,GAIPG,EAAgB,SAAAC,GAC3B,GAN8B,iBAMnBA,GAAOF,EAAOE,IAJV,SAAAJ,SAAW,WAANA,EAIYK,CAASD,GAAK,SANlC,MAOIX,yBAAhB,sHAAsB,IAAKW,EAAGE,kBAAqB,SACnD,UAGWC,EAAK,SAAAH,GAEhB,OADAA,EAAGI,OA3CoB,EA4ChBJ,GASHK,EAAO,SAAAC,mBAAON,GAElB,OADAA,EAAGO,IAAMD,EACFH,EAAGH,KAGCQ,EAAkCH,EApEF,GAqEhCI,EAAkCJ,EApEF,GAqEhCK,EAAkCL,EApEF,GAqEhCM,EAAkCN,EApEF,GAqEhCO,EAAkCP,EApEF,IAqEhCQ,EAAkCR,EApEF,IAqEhCS,EAAkCT,EApEF,IAqEhCU,EAAkCV,EApEF,KAsEvCW,EAAK,SAAAV,mBAAON,UAAMiB,QAAQjB,EAAGO,IAAMD,KAE5BY,EAAgCF,EA/EA,GAgFhCG,EAAgCH,EA/EA,GAgFhCI,EAAgCJ,EA/EA,GAgFhCK,EAAgCL,EA/EA,GAgFhCM,EAAgCN,EA/EA,IAgFhCO,EAAgCP,EA/EA,IAgFhCQ,EAAgCR,EA/EA,IAgFhCS,EAAgCT,EA/EA,KAkFhCU,EAAc,SAAA1B,UAAMiB,QAhFR,EAgFgBjB,EAAGI,SAWtCuB,WAAAA,EAAiB3B,EAAI4B,YAAAA,IAAAA,EAAM,+BACX5B,oBACpB,GADAA,EATe,SAAAA,GACf,cAAgBT,OAAOC,KAAKQ,kBAAK,CAA5B,IAAI6B,OACP,IAAKxC,EAAKyC,IAAID,GACZ,UAAUE,UAAUF,sDAExB,OAAO7B,EAIFgC,IACDN,EAAM1B,KAAQ4B,EAAIK,OAAQ,OAAOjC,EAFC,IAG/BkC,EAAeN,KAARO,EAAQP,kCACJM,iBAAZE,GACN,GA7D6B,mBA6DpBA,EAAM,OAAOT,EAAQS,EAAIpC,GAAKmC,GACvC,GAAIrC,EAAOsC,KAASA,EAAK,OAAOT,EAAQ3B,EAAImC,GAC5C,GAAIpC,EAAcqC,GAAM,OAAOT,EAAQS,EAAKD,GAC5C,UAAUJ,MAAM,uCARL,oCAiBPM,EAAW,SAAAC,UAAKA,SA5GG,QAgDN,SAACtC,EAAIuC,GAGtB,OAFAvC,EAAGI,OAjDoB,EAkDvBJ,EAAGuC,OAASA,EACLvC,iBAxDoC,gBACA,sBACA,4BAHA,OAOpB,gBAHoB,aANA,gBACA,YAFA,YAqItB,SAAA6B,mBAAO7B,GAE5B,cADOA,EAAGwC,QAAQX,GACX1B,EAAGH,WAhBO,SAACA,EAAI6B,EAAKY,GAC3B,OAA0B,MAAnBzC,EAAGwC,QAAQX,GAAeY,EAAWzC,EAAGwC,QAAQX,kBAlF9B,kBAAMpC,KAAKC,MAAMN,wHAkDjB,SAAAY,UAAMiB,QA9ER,EA8EgBjB,EAAGI,iOAuBxB,SAAPsC,+BAAWC,2BAAAA,sBACfC,EAAcD,KAARE,EAAQF,KACrB,OAAIhD,EAAQiD,IAAiB,MAARC,WAAqBjD,UAAK8C,EAAK9C,EAAGgD,IAChDjB,EAAQiB,EAAMC,UASJ,SAAChB,EAAKiB,mBAAU9C,GAEjC,OADAA,EAAGwC,QAAQX,GAAOiB,EACX3C,EAAGH,cAGU,SAAC6B,EAAKkB,mBAAAA,IAAAA,EAAKV,YAAarC,GAE5C,OADAA,EAAGwC,QAAQX,GAAOkB,EAAG/C,EAAGwC,QAAQX,GAAM7B,GAC/BG,EAAGH,WAxCe,SAAAA,UAAMA,EAAGuC"}