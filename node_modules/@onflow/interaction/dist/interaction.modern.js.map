{"version":3,"file":"interaction.modern.js","sources":["../src/interaction.js"],"sourcesContent":["export const UNKNOWN /*                 */ = 0b00000001\nexport const SCRIPT /*                  */ = 0b00000010\nexport const TRANSACTION /*             */ = 0b00000100\nexport const GET_TRANSACTION_STATUS /*  */ = 0b00001000\nexport const GET_ACCOUNT /*             */ = 0b00010000\nexport const GET_EVENTS /*              */ = 0b00100000\nexport const GET_LATEST_BLOCK /*        */ = 0b01000000\nexport const PING /*                    */ = 0b10000000\n\nexport const BAD /* */ = 0b01\nexport const OK /*  */ = 0b10\n\nconst IX = `{\n  \"tag\":${UNKNOWN},\n  \"assigns\":{},\n  \"status\":${OK},\n  \"reason\":null,\n  \"payload\":{\n    \"code\":null,\n    \"ref\":null,\n    \"nonce\":null,\n    \"limit\":null\n  },\n  \"bounds\":{\n    \"start\":null,\n    \"end\":null\n  },\n  \"acct\":null,\n  \"proposer\":null,\n  \"authz\":[],\n  \"payer\":null,\n  \"eventType\":null,\n  \"txId\":null,\n  \"isSealed\":null\n}`\n\nconst KEYS = new Set(Object.keys(JSON.parse(IX)))\n\nexport const interaction = () => JSON.parse(IX)\n\nconst isArray = d => Array.isArray(d)\nconst isObj = d => typeof d === \"object\"\nconst isNull = d => d == null\nconst isNumber = d => d === \"number\"\nconst isFn = d => typeof d === \"function\"\n\nexport const isInteraction = ix => {\n  if (!isObj(ix) || isNull(ix) || isNumber(ix)) return false\n  for (let key of KEYS) if (!ix.hasOwnProperty(key)) return false\n  return true\n}\n\nexport const Ok = ix => {\n  ix.status = OK\n  return ix\n}\n\nexport const Bad = (ix, reason) => {\n  ix.status = BAD\n  ix.reason = reason\n  return ix\n}\n\nconst make = wat => ix => {\n  ix.tag = wat\n  return Ok(ix)\n}\n\nexport const makeUnknown /*               */ = make(UNKNOWN)\nexport const makeScript /*                */ = make(SCRIPT)\nexport const makeTransaction /*           */ = make(TRANSACTION)\nexport const makeGetTransactionStatus /*  */ = make(GET_TRANSACTION_STATUS)\nexport const makeGetAccount /*            */ = make(GET_ACCOUNT)\nexport const makeGetEvents /*             */ = make(GET_EVENTS)\nexport const makeGetLatestBlock /*        */ = make(GET_LATEST_BLOCK)\nexport const makePing /*                  */ = make(PING)\n\nconst is = wat => ix => Boolean(ix.tag & wat)\n\nexport const isUnknown /*               */ = is(UNKNOWN)\nexport const isScript /*                */ = is(SCRIPT)\nexport const isTransaction /*           */ = is(TRANSACTION)\nexport const isGetTransactionStatus /*  */ = is(GET_TRANSACTION_STATUS)\nexport const isGetAccount /*            */ = is(GET_ACCOUNT)\nexport const isGetEvents /*             */ = is(GET_EVENTS)\nexport const isGetLatestBlock /*        */ = is(GET_LATEST_BLOCK)\nexport const isPing /*                  */ = is(PING)\n\nexport const isOk /*  */ = ix => Boolean(ix.status & OK)\nexport const isBad /* */ = ix => Boolean(ix.status & BAD)\nexport const why /*   */ = ix => ix.reason\n\nconst hardMode = ix => {\n  for (let key of Object.keys(ix)) {\n    if (!KEYS.has(key))\n      throw new Error(`\"${key}\" is an invalid root level Interaction property.`)\n  }\n  return ix\n}\n\nconst recPipe = async (ix, fns = []) => {\n  ix = hardMode(await ix)\n  if (isBad(ix) || !fns.length) return ix\n  const [hd, ...rest] = fns\n  const cur = await hd\n  if (isFn(cur)) return recPipe(cur(ix), rest)\n  if (isNull(cur) || !cur) return recPipe(ix, rest)\n  if (isInteraction(cur)) return recPipe(cur, rest)\n  throw new Error(\"Invalid Interaction Composition\")\n}\n\nexport const pipe = (...args) => {\n  const [arg1, arg2] = args\n  if (isArray(arg1) && arg2 == null) return d => pipe(d, arg1)\n  return recPipe(arg1, arg2)\n}\n\nconst identity = v => v\n\nexport const get = (ix, key, fallback) => {\n  return ix.assigns[key] == null ? fallback : ix.assigns[key]\n}\n\nexport const put = (key, value) => ix => {\n  ix.assigns[key] = value\n  return Ok(ix)\n}\n\nexport const update = (key, fn = identity) => ix => {\n  ix.assigns[key] = fn(ix.assigns[key], ix)\n  return Ok(ix)\n}\n\nexport const destroy = key => ix => {\n  delete ix.assigns[key]\n  return Ok(ix)\n}\n"],"names":["UNKNOWN","SCRIPT","TRANSACTION","GET_TRANSACTION_STATUS","GET_ACCOUNT","GET_EVENTS","GET_LATEST_BLOCK","PING","BAD","OK","IX","KEYS","Set","Object","keys","JSON","parse","interaction","isArray","d","Array","isNull","isInteraction","ix","isNumber","hasOwnProperty","Ok","status","Bad","reason","make","wat","tag","makeUnknown","makeScript","makeTransaction","makeGetTransactionStatus","makeGetAccount","makeGetEvents","makeGetLatestBlock","makePing","is","Boolean","isUnknown","isScript","isTransaction","isGetTransactionStatus","isGetAccount","isGetEvents","isGetLatestBlock","isPing","isOk","isBad","why","recPipe","fns","key","has","Error","hardMode","length","hd","rest","cur","pipe","args","arg1","arg2","identity","v","get","fallback","assigns","put","value","update","fn","destroy"],"mappings":"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"}