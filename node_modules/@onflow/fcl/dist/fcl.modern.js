import r from"queue-microtask";import{build as e,pipe as n,resolve as t,resolveParams as o,resolveAuthorizations as i,send as u}from"@onflow/sdk";function c(){return(c=Object.assign||function(r){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(r[t]=n[t])}return r}).apply(this,arguments)}function s(r,e){(null==e||e>r.length)&&(e=r.length);for(var n=0,t=new Array(e);n<e;n++)t[n]=r[n];return t}const a=function(){function r(){}return r.prototype.then=function(e,n){const t=new r,o=this.s;if(o){const r=1&o?e:n;if(r){try{f(t,1,r(this.v))}catch(r){f(t,2,r)}return t}return this}return this.o=function(r){try{const o=r.v;1&r.s?f(t,1,e?e(o):o):n?f(t,1,n(o)):f(t,2,o)}catch(r){f(t,2,r)}},t},r}();function f(r,e,n){if(!r.s){if(n instanceof a){if(!n.s)return void(n.o=f.bind(null,r,e));1&e&&(e=n.s),n=n.v}if(n&&n.then)return void n.then(f.bind(null,r,e),f.bind(null,r,2));r.s=e,r.v=n;const t=r.o;t&&t(r)}}function l(r){return r instanceof a&&1&r.s}function v(r,e,n){for(var t;;){var o=r();if(l(o)&&(o=o.v),!o)return i;if(o.then){t=0;break}var i=n();if(i&&i.then){if(!l(i)){t=1;break}i=i.s}if(e){var u=e();if(u&&u.then&&!l(u)){t=2;break}}}var c=new a,s=f.bind(null,c,2);return(0===t?o.then(d):1===t?i.then(v):u.then(h)).then(void 0,s),c;function v(t){i=t;do{if(e&&(u=e())&&u.then&&!l(u))return void u.then(h).then(void 0,s);if(!(o=r())||l(o)&&!o.v)return void f(c,1,i);if(o.then)return void o.then(d).then(void 0,s);l(i=n())&&(i=i.v)}while(!i||!i.then);i.then(v).then(void 0,s)}function d(r){r?(i=n())&&i.then?i.then(v).then(void 0,s):v(i):f(c,1,i)}function h(){(o=r())?o.then?o.then(d).then(void 0,s):d(o):f(c,1,i)}}"undefined"!=typeof Symbol&&(Symbol.iterator||(Symbol.iterator=Symbol("Symbol.iterator"))),"undefined"!=typeof Symbol&&(Symbol.asyncIterator||(Symbol.asyncIterator=Symbol("Symbol.asyncIterator")));var d={},h=0,m=function(r,e,n,t){return void 0===t&&(t={}),new Promise(function(o,i){var u=t.expectReply||!1,c=null!=t.timeout?t.timeout:5e3;u&&c&&setTimeout(function(){return i(new Error("Timeout: "+c+"ms passed without a response."))},c);var s={to:r,from:t.from,tag:e,data:n,timeout:c,reply:o,reject:i};try{d[r].mailbox.deliver(s),u||o(!0)}catch(r){console.error("FCL.Actor -- Could Not Deliver Message",s,r)}})},y=function(e,n){if(void 0===n&&(n=null),null==n&&(n=++h),null!=d[n])return n;var t,o;d[n]={addr:n,mailbox:(o=[],{deliver:function(r){try{return o.push(r),t&&(t(o.shift()),t=void 0),Promise.resolve()}catch(r){return Promise.reject(r)}},receive:function(){return new Promise(function(r){var e=o.shift();if(e)return r(e);t=r})}}),subs:new Set,kvs:{}};var i={self:function(){return n},receive:function(){return d[n].mailbox.receive()},send:function(r,e,t,o){return void 0===o&&(o={}),o.from=n,m(r,e,t,o)},broadcast:function(r,e,t){void 0===t&&(t={}),t.from=n;for(var o,i=function(r){var e=0;if("undefined"==typeof Symbol||null==r[Symbol.iterator]){if(Array.isArray(r)||(r=function(r,e){if(r){if("string"==typeof r)return s(r,void 0);var n=Object.prototype.toString.call(r).slice(8,-1);return"Object"===n&&r.constructor&&(n=r.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?s(r,void 0):void 0}}(r)))return function(){return e>=r.length?{done:!0}:{done:!1,value:r[e++]}};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(e=r[Symbol.iterator]()).next.bind(e)}(d[n].subs);!(o=i()).done;)m(o.value,r,e,t)},subscribe:function(r){return null!=r&&d[n].subs.add(r)},unsubscribe:function(r){return null!=r&&d[n].subs.delete(r)},put:function(r,e){null!=r&&(d[n].kvs[r]=e)},get:function(r,e){var t=d[n].kvs[r];return null==t?e:t},delete:function(r){delete d[n].kvs[r]},update:function(r,e){null!=r&&(d[n].kvs[r]=e(d[n].kvs[r]))},keys:function(){return Object.keys(d[n].kvs)}};return r(function(){try{return Promise.resolve(e(i)).then(function(){!function(r){delete d[r]}(n)})}catch(r){return Promise.reject(r)}}),n},b="config",p="PUT_CONFIG",P="GET_CONFIG",k="CONFIG/UPDATED";y(function(r){try{var e=function(e){return e.reduce(function(e,n){var t;return c({},e,((t={})[n]=r.get(n),t))},{})},n=v(function(){return 1},void 0,function(){return Promise.resolve(r.receive()).then(function(n){var t=n.data;try{switch(n.tag){case p:return void(null!=t.key&&(r.put(t.key,t.value),r.broadcast(k,e(r.keys()))));case P:return void(null!=t.key&&n.reply(r.get(t.key,t.fallback)));case"UPDATE_CONFIG":return void(null!=t.key&&(r.update(t.key,t.fn),r.broadcast(k,e(r.keys()))));case"DELETE_CONFIG":return void(null!=t.key&&(r.delete(t.key),r.broadcast(k,e(r.keys()))));case"WHERE_CONFIG":return void(null!=t.pattern&&n.reply(e(r.keys().filter(function(r){return t.pattern.test(r)}))));case"SUBSCRIBE":return r.subscribe(n.from),void r.send(n.from,k,e(r.keys()));case"UNSUBSCRIBE":return void r.unsubscribe(n.from);default:return}}catch(r){return void console.error("Config Error",n,r)}})});return Promise.resolve(n&&n.then?n.then(function(){}):void 0)}catch(r){return Promise.reject(r)}},b);var S=function(r){return r},E=function(){return{put:function(r,e){m(b,p,{key:r,value:e})},get:function(r,e){return m(b,P,{key:r,fallback:e},{expectReply:!0,timeout:10})},update:function(r,e){void 0===e&&(e=S),m(b,"UPDATE_CONFIG",{key:r,fn:e})},delete:function(r){m(b,"DELETE_CONFIG",{key:r})},where:function(r){return m(b,"WHERE_CONFIG",{pattern:r},{expectReply:!0,timeout:10})},subscribe:function(r){var e=y(function(e){try{var n=!1;return e.send(b,"SUBSCRIBE"),Promise.resolve(v(function(){return!n&&1},void 0,function(){return Promise.resolve(e.receive()).then(function(t){if("@EXIT"===t.tag)return e.send(b,"UNSUBSCRIBE"),void(n=!0);r(t.data)})}))}catch(r){return Promise.reject(r)}});return function(){return m(e,"@EXIT")}}}};E().put("accessNode.api","http://localhost:8080");var I,g=function(r,c){void 0===r&&(r=[]),void 0===c&&(c={});try{var s=function(s){return c.node=s,Array.isArray(r)&&(r=e(r)),Promise.resolve(n(r,[t([o,i])])).then(function(r){return u(r,c)})},a=c.node;return Promise.resolve(a?s(a):Promise.resolve(E().get("accessNode.api")).then(s))}catch(r){return Promise.reject(r)}},j=function(r){return"https://avatars.onflow.org/avatar/"+r+".svg"},w=function(r,e){return e.reduce(function(e,n){var t;return c({},e,((t={})[n]=r.get(n),t))},{})},C=((I={}).SUBSCRIBE=function(r,e){r.subscribe(e.from),r.send(e.from,"USER/UPDATED",w(r,r.keys()))},I.UNSUBSCRIBE=function(r,e){r.unsubscribe(e.from)},I.SNAPSHOT=function(r,e){try{return e.reply(w(r,r.keys())),Promise.resolve()}catch(r){return Promise.reject(r)}},I),U=function(r){try{return Promise.resolve(function(r){try{return Promise.resolve((void 0===e&&(e=10),new Promise(function(r){return setTimeout(r,e)}))).then(function(){return{acct:r,name:"bob the builder",avatar:j(),bio:"Can he fix it, yes he can.",hooks:{}}})}catch(r){return Promise.reject(r)}var e}(r.self())).then(function(e){!function(r,e){for(var n=0,t=Object.keys(e);n<t.length;n++){var o=t[n];r.put(o,e[o])}}(r,e);var n=v(function(){return 1},void 0,function(){return Promise.resolve(r.receive()).then(function(e){var n=function(n,t){try{var o=function(n,t){try{var o=Promise.resolve(C[e.tag](r,e)).then(function(){})}catch(r){return t(r)}return o&&o.then?o.then(void 0,t):o}(0,function(r){console.error("User Error",e,r)})}catch(r){return}return o&&o.then?o.then(t.bind(null,!1),t.bind(null,!0)):void 0}(0,function(r,e){});if(n&&n.then)return n.then(function(){})})});return n&&n.then?n.then(function(){}):void 0})}catch(r){return Promise.reject(r)}},A=function(r){return y(U,r)},N=function(r){return{authorization:function(){try{return A(r),Promise.resolve({acct:r,signFn:function(){try{throw new Error("fcl.user("+r+").payerAuthorization WIP error -- known missing functionality")}catch(r){return Promise.reject(r)}}})}catch(r){return Promise.reject(r)}},payerAuthorization:function(){try{return A(r),Promise.resolve({acct:r,signFn:function(){try{throw new Error("fcl.user("+r+").payerAuthorization WIP error -- known missing functionality")}catch(r){return Promise.reject(r)}}})}catch(r){return Promise.reject(r)}},snapshot:function(){try{return A(r),Promise.resolve(m(r,"SNAPSHOT",null,{expectReply:!0,timeout:0}))}catch(r){return Promise.reject(r)}},param:function(e){return{value:r,xform:{asParam:function(r){return r},asInjection:function(r){return r}}}},subscribe:function(e){A(r);var n=y(function(n){try{var t=!1;return n.send(r,"SUBSCRIBE"),Promise.resolve(v(function(){return!t&&1},void 0,function(){return Promise.resolve(n.receive()).then(function(o){if("@EXIT"===o.tag)return n.send(r,"UNSUBSCRIBE"),void(t=!0);e(o.data)})}))}catch(r){return Promise.reject(r)}});return function(){return m(n,"@EXIT")}}}},O=function(){return Promise.resolve()},T=function(){return Promise.resolve()},B=function(){return{subscribe:function(r){return function(){}},authorization:function(){return Promise.resolve()},payerAuthorization:function(){return Promise.resolve()},param:function(){return Promise.resolve()}}},R=function(r){return{subscribe:function(r){return function(){}}}},F=function(r,e){return{subscribe:function(r){return function(){}}}},x=function(r){return Promise.resolve()};export{O as authenticate,E as config,B as currentUser,x as decode,F as event,g as send,R as transaction,T as unauthenticate,N as user};
//# sourceMappingURL=fcl.modern.js.map
