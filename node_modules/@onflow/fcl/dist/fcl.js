var e,r=(e=require("queue-microtask"))&&"object"==typeof e&&"default"in e?e.default:e,t=require("@onflow/sdk");function n(){return(n=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e}).apply(this,arguments)}function o(e,r){(null==r||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}const i=function(){function e(){}return e.prototype.then=function(r,t){const n=new e,o=this.s;if(o){const e=1&o?r:t;if(e){try{u(n,1,e(this.v))}catch(e){u(n,2,e)}return n}return this}return this.o=function(e){try{const o=e.v;1&e.s?u(n,1,r?r(o):o):t?u(n,1,t(o)):u(n,2,o)}catch(e){u(n,2,e)}},n},e}();function u(e,r,t){if(!e.s){if(t instanceof i){if(!t.s)return void(t.o=u.bind(null,e,r));1&r&&(r=t.s),t=t.v}if(t&&t.then)return void t.then(u.bind(null,e,r),u.bind(null,e,2));e.s=r,e.v=t;const n=e.o;n&&n(e)}}function c(e){return e instanceof i&&1&e.s}function s(e,r,t){for(var n;;){var o=e();if(c(o)&&(o=o.v),!o)return s;if(o.then){n=0;break}var s=t();if(s&&s.then){if(!c(s)){n=1;break}s=s.s}if(r){var a=r();if(a&&a.then&&!c(a)){n=2;break}}}var f=new i,l=u.bind(null,f,2);return(0===n?o.then(d):1===n?s.then(v):a.then(h)).then(void 0,l),f;function v(n){s=n;do{if(r&&(a=r())&&a.then&&!c(a))return void a.then(h).then(void 0,l);if(!(o=e())||c(o)&&!o.v)return void u(f,1,s);if(o.then)return void o.then(d).then(void 0,l);c(s=t())&&(s=s.v)}while(!s||!s.then);s.then(v).then(void 0,l)}function d(e){e?(s=t())&&s.then?s.then(v).then(void 0,l):v(s):u(f,1,s)}function h(){(o=e())?o.then?o.then(d).then(void 0,l):d(o):u(f,1,s)}}"undefined"!=typeof Symbol&&(Symbol.iterator||(Symbol.iterator=Symbol("Symbol.iterator"))),"undefined"!=typeof Symbol&&(Symbol.asyncIterator||(Symbol.asyncIterator=Symbol("Symbol.asyncIterator")));var a={},f=0,l=function(e,r,t,n){return void 0===n&&(n={}),new Promise(function(o,i){var u=n.expectReply||!1,c=null!=n.timeout?n.timeout:5e3;u&&c&&setTimeout(function(){return i(new Error("Timeout: "+c+"ms passed without a response."))},c);var s={to:e,from:n.from,tag:r,data:t,timeout:c,reply:o,reject:i};try{a[e].mailbox.deliver(s),u||o(!0)}catch(e){console.error("FCL.Actor -- Could Not Deliver Message",s,e)}})},v=function(e,t){if(void 0===t&&(t=null),null==t&&(t=++f),null!=a[t])return t;var n,i;a[t]={addr:t,mailbox:(i=[],{deliver:function(e){try{return i.push(e),n&&(n(i.shift()),n=void 0),Promise.resolve()}catch(e){return Promise.reject(e)}},receive:function(){return new Promise(function(e){var r=i.shift();if(r)return e(r);n=e})}}),subs:new Set,kvs:{}};var u={self:function(){return t},receive:function(){return a[t].mailbox.receive()},send:function(e,r,n,o){return void 0===o&&(o={}),o.from=t,l(e,r,n,o)},broadcast:function(e,r,n){void 0===n&&(n={}),n.from=t;for(var i,u=function(e){var r=0;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=function(e,r){if(e){if("string"==typeof e)return o(e,void 0);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(t):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?o(e,void 0):void 0}}(e)))return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(r=e[Symbol.iterator]()).next.bind(r)}(a[t].subs);!(i=u()).done;)l(i.value,e,r,n)},subscribe:function(e){return null!=e&&a[t].subs.add(e)},unsubscribe:function(e){return null!=e&&a[t].subs.delete(e)},put:function(e,r){null!=e&&(a[t].kvs[e]=r)},get:function(e,r){var n=a[t].kvs[e];return null==n?r:n},delete:function(e){delete a[t].kvs[e]},update:function(e,r){null!=e&&(a[t].kvs[e]=r(a[t].kvs[e]))},keys:function(){return Object.keys(a[t].kvs)}};return r(function(){try{return Promise.resolve(e(u)).then(function(){!function(e){delete a[e]}(t)})}catch(e){return Promise.reject(e)}}),t},d="config",h="PUT_CONFIG",m="GET_CONFIG",y="CONFIG/UPDATED";v(function(e){try{var r=function(r){return r.reduce(function(r,t){var o;return n({},r,((o={})[t]=e.get(t),o))},{})},t=s(function(){return 1},void 0,function(){return Promise.resolve(e.receive()).then(function(t){var n=t.data;try{switch(t.tag){case h:return void(null!=n.key&&(e.put(n.key,n.value),e.broadcast(y,r(e.keys()))));case m:return void(null!=n.key&&t.reply(e.get(n.key,n.fallback)));case"UPDATE_CONFIG":return void(null!=n.key&&(e.update(n.key,n.fn),e.broadcast(y,r(e.keys()))));case"DELETE_CONFIG":return void(null!=n.key&&(e.delete(n.key),e.broadcast(y,r(e.keys()))));case"WHERE_CONFIG":return void(null!=n.pattern&&t.reply(r(e.keys().filter(function(e){return n.pattern.test(e)}))));case"SUBSCRIBE":return e.subscribe(t.from),void e.send(t.from,y,r(e.keys()));case"UNSUBSCRIBE":return void e.unsubscribe(t.from);default:return}}catch(e){return void console.error("Config Error",t,e)}})});return Promise.resolve(t&&t.then?t.then(function(){}):void 0)}catch(e){return Promise.reject(e)}},d);var b=function(e){return e},p=function(){return{put:function(e,r){l(d,h,{key:e,value:r})},get:function(e,r){return l(d,m,{key:e,fallback:r},{expectReply:!0,timeout:10})},update:function(e,r){void 0===r&&(r=b),l(d,"UPDATE_CONFIG",{key:e,fn:r})},delete:function(e){l(d,"DELETE_CONFIG",{key:e})},where:function(e){return l(d,"WHERE_CONFIG",{pattern:e},{expectReply:!0,timeout:10})},subscribe:function(e){var r=v(function(r){try{var t=!1;return r.send(d,"SUBSCRIBE"),Promise.resolve(s(function(){return!t&&1},void 0,function(){return Promise.resolve(r.receive()).then(function(n){if("@EXIT"===n.tag)return r.send(d,"UNSUBSCRIBE"),void(t=!0);e(n.data)})}))}catch(e){return Promise.reject(e)}});return function(){return l(r,"@EXIT")}}}};p().put("accessNode.api","http://localhost:8080");var P,k=function(e){return"https://avatars.onflow.org/avatar/"+e+".svg"},S=function(e,r){return r.reduce(function(r,t){var o;return n({},r,((o={})[t]=e.get(t),o))},{})},E=((P={}).SUBSCRIBE=function(e,r){e.subscribe(r.from),e.send(r.from,"USER/UPDATED",S(e,e.keys()))},P.UNSUBSCRIBE=function(e,r){e.unsubscribe(r.from)},P.SNAPSHOT=function(e,r){try{return r.reply(S(e,e.keys())),Promise.resolve()}catch(e){return Promise.reject(e)}},P),g=function(e){try{return Promise.resolve(function(e){try{return Promise.resolve((void 0===r&&(r=10),new Promise(function(e){return setTimeout(e,r)}))).then(function(){return{acct:e,name:"bob the builder",avatar:k(),bio:"Can he fix it, yes he can.",hooks:{}}})}catch(e){return Promise.reject(e)}var r}(e.self())).then(function(r){!function(e,r){for(var t=0,n=Object.keys(r);t<n.length;t++){var o=n[t];e.put(o,r[o])}}(e,r);var t=s(function(){return 1},void 0,function(){return Promise.resolve(e.receive()).then(function(r){var t=function(t,n){try{var o=function(t,n){try{var o=Promise.resolve(E[r.tag](e,r)).then(function(){})}catch(e){return n(e)}return o&&o.then?o.then(void 0,n):o}(0,function(e){console.error("User Error",r,e)})}catch(e){return}return o&&o.then?o.then(n.bind(null,!1),n.bind(null,!0)):void 0}(0,function(e,r){});if(t&&t.then)return t.then(function(){})})});return t&&t.then?t.then(function(){}):void 0})}catch(e){return Promise.reject(e)}},I=function(e){return v(g,e)};exports.authenticate=function(){return Promise.resolve()},exports.config=p,exports.currentUser=function(){return{subscribe:function(e){return function(){}},authorization:function(){return Promise.resolve()},payerAuthorization:function(){return Promise.resolve()},param:function(){return Promise.resolve()}}},exports.decode=function(e){return Promise.resolve()},exports.event=function(e,r){return{subscribe:function(e){return function(){}}}},exports.send=function(e,r){void 0===e&&(e=[]),void 0===r&&(r={});try{var n=function(n){return r.node=n,Array.isArray(e)&&(e=t.build(e)),Promise.resolve(t.pipe(e,[t.resolve([t.resolveParams,t.resolveAuthorizations])])).then(function(e){return t.send(e,r)})},o=r.node;return Promise.resolve(o?n(o):Promise.resolve(p().get("accessNode.api")).then(n))}catch(e){return Promise.reject(e)}},exports.transaction=function(e){return{subscribe:function(e){return function(){}}}},exports.unauthenticate=function(){return Promise.resolve()},exports.user=function(e){return{authorization:function(){try{return I(e),Promise.resolve({acct:e,signFn:function(){try{throw new Error("fcl.user("+e+").payerAuthorization WIP error -- known missing functionality")}catch(e){return Promise.reject(e)}}})}catch(e){return Promise.reject(e)}},payerAuthorization:function(){try{return I(e),Promise.resolve({acct:e,signFn:function(){try{throw new Error("fcl.user("+e+").payerAuthorization WIP error -- known missing functionality")}catch(e){return Promise.reject(e)}}})}catch(e){return Promise.reject(e)}},snapshot:function(){try{return I(e),Promise.resolve(l(e,"SNAPSHOT",null,{expectReply:!0,timeout:0}))}catch(e){return Promise.reject(e)}},param:function(r){return{value:e,xform:{asParam:function(e){return e},asInjection:function(e){return e}}}},subscribe:function(r){I(e);var t=v(function(t){try{var n=!1;return t.send(e,"SUBSCRIBE"),Promise.resolve(s(function(){return!n&&1},void 0,function(){return Promise.resolve(t.receive()).then(function(o){if("@EXIT"===o.tag)return t.send(e,"UNSUBSCRIBE"),void(n=!0);r(o.data)})}))}catch(e){return Promise.reject(e)}});return function(){return l(t,"@EXIT")}}}};
//# sourceMappingURL=fcl.js.map
