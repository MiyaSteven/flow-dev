var e=require("@onflow/interaction"),t=require("@onflow/protobuf"),r=require("@onflow/response"),n=require("@improbable-eng/grpc-web"),s=require("@improbable-eng/grpc-web-node-http-transport"),a=function(e,t,r){try{return Promise.resolve(new Promise(function(s,a){n.grpc.unary(t,{request:r,host:e,onEnd:function(e){var t=e.statusMessage;e.status===n.grpc.Code.OK?s(e.message):a(new Error(t))}})}))}catch(e){return Promise.reject(e)}};n.grpc.setDefaultTransport(s.NodeHttpTransport());var o=function(e){return Buffer.from(e,"hex")},i=function(e){return Buffer.from(e.padStart(40,0),"hex")},c=function(e){return Buffer.from(e).toString("hex")},u=function(e){return Buffer.from(e).toString("hex")};exports.send=function(n,s){void 0===s&&(s={});try{switch(!0){case e.isTransaction(n):return Promise.resolve(function(e,n){void 0===n&&(n={});try{var s=new t.Transaction;s.setScript(Buffer.from(e.payload.code,"utf8")),s.setGasLimit(e.payload.limit),s.setReferenceBlockId(e.payload.ref?o(e.payload.ref):null),s.setPayer(i(e.payer.acct)),e.authz.forEach(function(e){return s.addAuthorizers(i(e.acct))});var c=new t.Transaction.ProposalKey;c.setAddress(i(e.proposer.addr)),c.setKeyId(e.proposer.keyId),c.setSequenceNumber(e.proposer.sequenceNum),s.setProposalKey(c),e.authz.forEach(function(e){if(null!==e.signature){var r=new t.Transaction.Signature;r.setAddress(i(e.acct)),r.setKeyId(e.keyId),r.setSignature(o(e.signature)),s.addPayloadSignatures(r)}});var u=new t.Transaction.Signature;u.setAddress(i(e.payer.acct)),u.setKeyId(e.payer.keyId),u.setSignature(o(e.payer.signature)),s.addEnvelopeSignatures(u);var g=new t.SendTransactionRequest;return g.setTransaction(s),Promise.resolve(a(n.node,t.AccessAPI.SendTransaction,g)).then(function(t){var n,s=r.response();return s.tag=e.tag,s.transactionId=(n=t.getId_asU8(),Buffer.from(n).toString("hex")),s})}catch(e){return Promise.reject(e)}}(n,s));case e.isGetTransactionStatus(n):return Promise.resolve(function(e,n){void 0===n&&(n={});try{var s=new t.GetTransactionRequest;return s.setId(Buffer.from(e.txId,"hex")),Promise.resolve(a(n.node,t.AccessAPI.GetTransactionResult,s)).then(function(t){var n=t.getEventsList(),s=r.response();return s.tag=e.tag,s.transaction={status:t.getStatus(),statusCode:t.getStatusCode(),errorMessage:t.getErrorMessage(),events:n.map(function(e){return{type:e.getType(),transactionId:(t=e.getTransactionId_asU8(),Buffer.from(t).toString("hex")),transactionIndex:e.getTransactionIndex(),eventIndex:e.getEventIndex(),payload:e.getPayload_asU8()};var t})},s})}catch(e){return Promise.reject(e)}}(n,s));case e.isScript(n):return Promise.resolve(function(e,n){void 0===n&&(n={});try{var s=new t.ExecuteScriptAtLatestBlockRequest,o=Buffer.from(e.payload.code,"utf8");return s.setScript(o),Promise.resolve(a(n.node,t.AccessAPI.ExecuteScriptAtLatestBlock,s)).then(function(t){var n=r.response();return n.tag=e.tag,n.encodedData=t.getValue_asU8(),n})}catch(e){return Promise.reject(e)}}(n,s));case e.isGetAccount(n):return Promise.resolve(function(e,n){void 0===n&&(n={});try{var s=new t.GetAccountRequest;return s.setAddress(Buffer.from(e.acct.padStart(40,0),"hex")),Promise.resolve(a(n.node,t.AccessAPI.GetAccount,s)).then(function(t){var n=r.response();n.tag=e.tag;var s=t.getAccount();return n.account={address:c(s.getAddress_asU8()),balance:s.getBalance(),code:s.getCode_asU8(),keys:s.getKeysList().map(function(e){return{index:e.getIndex(),publicKey:c(e.getPublicKey_asU8()),signAlgo:e.getSignAlgo(),hashAlgo:e.getHashAlgo(),weight:e.getWeight(),sequenceNumber:e.getSequenceNumber()}})},n})}catch(e){return Promise.reject(e)}}(n,s));case e.isGetEvents(n):return Promise.resolve(function(e,n){void 0===n&&(n={});try{var s=new t.GetEventsForHeightRangeRequest;return s.setType(e.eventType),s.setStartHeight(Number(e.bounds.start)),s.setEndHeight(Number(e.bounds.end)),Promise.resolve(a(n.node,t.AccessAPI.GetEventsForHeightRange,s)).then(function(t){var n=r.response();n.tag=e.tag;var s=t.getResultsList();return n.events=s.map(function(e){var t=e.getEventsList();return{blockId:e.getBlockId(),blockHeight:e.getBlockHeight(),events:t.map(function(e){return{type:e.getType(),transactionId:(t=e.getTransactionId_asU8(),Buffer.from(t).toString("hex")),transactionIndex:e.getTransactionIndex(),eventIndex:e.getEventIndex(),payload:e.getPayload_asU8()};var t})}}),n})}catch(e){return Promise.reject(e)}}(n,s));case e.isGetLatestBlock(n):return Promise.resolve(function(e,n){void 0===n&&(n={});try{var s=new t.GetLatestBlockRequest;return s.setIsSealed(e.isSealed),Promise.resolve(a(n.node,t.AccessAPI.GetLatestBlock,s)).then(function(t){var n=t.getBlock(),s=n.getCollectionGuaranteesList(),a=n.getBlockSealsList(),o=n.getSignaturesList(),i=r.response();return i.tag=e.tag,i.latestBlock={id:u(n.getId_asU8()),parentId:u(n.getParentId_asU8()),height:n.getHeight(),timestamp:n.getTimestamp(),collectionGuarantees:s.map(function(e){return{collectionId:u(e.getCollectionId_asU8()),signatures:e.getSignaturesList()}}),blockSeals:a.map(function(e){return{blockId:u(e.getBlockId_asU8()),executionReceiptId:u(e.getExecutionReceiptId_asU8()),executionReceiptSignatures:e.getExecutionReceiptSignaturesList(),resultApprovalSignatures:e.getResultApprovalSignaturesList()}}),signatures:o},i})}catch(e){return Promise.reject(e)}}(n,s));case e.isPing(n):return Promise.resolve(function(e,n){void 0===n&&(n={});try{var s=new t.PingRequest;return Promise.resolve(a(n.node,t.AccessAPI.Ping,s)).then(function(t){var n=r.response();return n.tag=e.tag,n})}catch(e){return Promise.reject(e)}}(n,s));default:return Promise.resolve(n)}}catch(e){return Promise.reject(e)}};
//# sourceMappingURL=send.js.map
