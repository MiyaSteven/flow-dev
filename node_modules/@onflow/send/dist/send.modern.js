import{isPing as e,isGetLatestBlock as t,isGetEvents as r,isGetAccount as n,isScript as o,isGetTransactionStatus as a,isTransaction as s}from"@onflow/interaction";import{Transaction as i,SendTransactionRequest as u,AccessAPI as c,GetTransactionRequest as g,ExecuteScriptAtLatestBlockRequest as d,GetAccountRequest as f,GetEventsForHeightRangeRequest as l,GetLatestBlockRequest as m,PingRequest as p}from"@onflow/protobuf";import{response as v}from"@onflow/response";import{grpc as h}from"@improbable-eng/grpc-web";import{NodeHttpTransport as y}from"@improbable-eng/grpc-web-node-http-transport";var I=function(e,t,r){try{return Promise.resolve(new Promise(function(n,o){h.unary(t,{request:r,host:e,onEnd:function(e){var t=e.statusMessage;e.status===h.Code.OK?n(e.message):o(new Error(t))}})}))}catch(e){return Promise.reject(e)}};h.setDefaultTransport(y());var P=function(e){return Buffer.from(e,"hex")},S=function(e){return Buffer.from(e.padStart(40,0),"hex")},x=function(e){return Buffer.from(e).toString("hex")},b=function(e){return Buffer.from(e).toString("hex")},B=function(h,y){void 0===y&&(y={});try{switch(!0){case s(h):return Promise.resolve(function(e,t){void 0===t&&(t={});try{var r=new i;r.setScript(Buffer.from(e.payload.code,"utf8")),r.setGasLimit(e.payload.limit),r.setReferenceBlockId(e.payload.ref?P(e.payload.ref):null),r.setPayer(S(e.payer.acct)),e.authz.forEach(function(e){return r.addAuthorizers(S(e.acct))});var n=new i.ProposalKey;n.setAddress(S(e.proposer.addr)),n.setKeyId(e.proposer.keyId),n.setSequenceNumber(e.proposer.sequenceNum),r.setProposalKey(n),e.authz.forEach(function(e){if(null!==e.signature){var t=new i.Signature;t.setAddress(S(e.acct)),t.setKeyId(e.keyId),t.setSignature(P(e.signature)),r.addPayloadSignatures(t)}});var o=new i.Signature;o.setAddress(S(e.payer.acct)),o.setKeyId(e.payer.keyId),o.setSignature(P(e.payer.signature)),r.addEnvelopeSignatures(o);var a=new u;return a.setTransaction(r),Promise.resolve(I(t.node,c.SendTransaction,a)).then(function(t){var r,n=v();return n.tag=e.tag,n.transactionId=(r=t.getId_asU8(),Buffer.from(r).toString("hex")),n})}catch(e){return Promise.reject(e)}}(h,y));case a(h):return Promise.resolve(function(e,t){void 0===t&&(t={});try{var r=new g;return r.setId(Buffer.from(e.txId,"hex")),Promise.resolve(I(t.node,c.GetTransactionResult,r)).then(function(t){var r=t.getEventsList(),n=v();return n.tag=e.tag,n.transaction={status:t.getStatus(),statusCode:t.getStatusCode(),errorMessage:t.getErrorMessage(),events:r.map(function(e){return{type:e.getType(),transactionId:(t=e.getTransactionId_asU8(),Buffer.from(t).toString("hex")),transactionIndex:e.getTransactionIndex(),eventIndex:e.getEventIndex(),payload:e.getPayload_asU8()};var t})},n})}catch(e){return Promise.reject(e)}}(h,y));case o(h):return Promise.resolve(function(e,t){void 0===t&&(t={});try{var r=new d,n=Buffer.from(e.payload.code,"utf8");return r.setScript(n),Promise.resolve(I(t.node,c.ExecuteScriptAtLatestBlock,r)).then(function(t){var r=v();return r.tag=e.tag,r.encodedData=t.getValue_asU8(),r})}catch(e){return Promise.reject(e)}}(h,y));case n(h):return Promise.resolve(function(e,t){void 0===t&&(t={});try{var r=new f;return r.setAddress(Buffer.from(e.acct.padStart(40,0),"hex")),Promise.resolve(I(t.node,c.GetAccount,r)).then(function(t){var r=v();r.tag=e.tag;var n=t.getAccount();return r.account={address:x(n.getAddress_asU8()),balance:n.getBalance(),code:n.getCode_asU8(),keys:n.getKeysList().map(function(e){return{index:e.getIndex(),publicKey:x(e.getPublicKey_asU8()),signAlgo:e.getSignAlgo(),hashAlgo:e.getHashAlgo(),weight:e.getWeight(),sequenceNumber:e.getSequenceNumber()}})},r})}catch(e){return Promise.reject(e)}}(h,y));case r(h):return Promise.resolve(function(e,t){void 0===t&&(t={});try{var r=new l;return r.setType(e.eventType),r.setStartHeight(Number(e.bounds.start)),r.setEndHeight(Number(e.bounds.end)),Promise.resolve(I(t.node,c.GetEventsForHeightRange,r)).then(function(t){var r=v();r.tag=e.tag;var n=t.getResultsList();return r.events=n.map(function(e){var t=e.getEventsList();return{blockId:e.getBlockId(),blockHeight:e.getBlockHeight(),events:t.map(function(e){return{type:e.getType(),transactionId:(t=e.getTransactionId_asU8(),Buffer.from(t).toString("hex")),transactionIndex:e.getTransactionIndex(),eventIndex:e.getEventIndex(),payload:e.getPayload_asU8()};var t})}}),r})}catch(e){return Promise.reject(e)}}(h,y));case t(h):return Promise.resolve(function(e,t){void 0===t&&(t={});try{var r=new m;return r.setIsSealed(e.isSealed),Promise.resolve(I(t.node,c.GetLatestBlock,r)).then(function(t){var r=t.getBlock(),n=r.getCollectionGuaranteesList(),o=r.getBlockSealsList(),a=r.getSignaturesList(),s=v();return s.tag=e.tag,s.latestBlock={id:b(r.getId_asU8()),parentId:b(r.getParentId_asU8()),height:r.getHeight(),timestamp:r.getTimestamp(),collectionGuarantees:n.map(function(e){return{collectionId:b(e.getCollectionId_asU8()),signatures:e.getSignaturesList()}}),blockSeals:o.map(function(e){return{blockId:b(e.getBlockId_asU8()),executionReceiptId:b(e.getExecutionReceiptId_asU8()),executionReceiptSignatures:e.getExecutionReceiptSignaturesList(),resultApprovalSignatures:e.getResultApprovalSignaturesList()}}),signatures:a},s})}catch(e){return Promise.reject(e)}}(h,y));case e(h):return Promise.resolve(function(e,t){void 0===t&&(t={});try{var r=new p;return Promise.resolve(I(t.node,c.Ping,r)).then(function(t){var r=v();return r.tag=e.tag,r})}catch(e){return Promise.reject(e)}}(h,y));default:return Promise.resolve(h)}}catch(e){return Promise.reject(e)}};export{B as send};
//# sourceMappingURL=send.modern.js.map
