!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports,require("@onflow/interaction"),require("@onflow/send"),require("@onflow/decode"),require("@qvvg/templar"),require("@onflow/encode")):"function"==typeof define&&define.amd?define(["exports","@onflow/interaction","@onflow/send","@onflow/decode","@qvvg/templar","@onflow/encode"],n):n((e=e||self).sdk={},e.interaction,e.send,e.decode,e.templar,e.encode)}(this,function(e,n,t,r,o,i){var a=n.pipe;function u(){return(u=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e}).apply(this,arguments)}var c={asParam:function(e){return e},asInjection:function(e){return e}};function p(e,n,t){return{addr:e,keyId:n,sequenceNum:t}}var s=[];function d(){return Date.now()}function f(e){return function(n){return null==n?e:n}}function l(e,n,t){return{acct:e,signature:n,keyId:t}}var y=n.pipe([function(e){if(!n.isTransaction(e)&&!n.isScript(e))return n.Ok(e);var t=n.get(e,"ix.code");return e.payload.code="function"==typeof t?t(n.get(e,"ix.params",{})):t,n.Ok(e)}]);Object.defineProperty(e,"isBad",{enumerable:!0,get:function(){return n.isBad}}),Object.defineProperty(e,"isOk",{enumerable:!0,get:function(){return n.isOk}}),Object.defineProperty(e,"pipe",{enumerable:!0,get:function(){return n.pipe}}),Object.defineProperty(e,"why",{enumerable:!0,get:function(){return n.why}}),Object.defineProperty(e,"send",{enumerable:!0,get:function(){return t.send}}),Object.defineProperty(e,"decode",{enumerable:!0,get:function(){return r.decode}}),Object.defineProperty(e,"decodeResponse",{enumerable:!0,get:function(){return r.decodeResponse}}),e.authorization=function(e,n,t){return{acct:e,signFn:n,keyId:t}},e.authorizations=function(e){return void 0===e&&(e=[]),n.pipe([n.put("tx.authorizations",e)])},e.build=function(e){return void 0===e&&(e=[]),n.pipe(n.interaction(),e)},e.getAccount=function(e){return n.pipe([n.makeGetAccount,function(t){return t.acct=e,n.Ok(t)}])},e.getEvents=function(e,t,r){return n.pipe([n.makeGetEvents,function(t){return t.eventType=e,n.Ok(t)},function(e){return e.bounds.start=t,n.Ok(e)},function(e){return e.bounds.end=r,n.Ok(e)}])},e.getLatestBlock=function(e){return void 0===e&&(e=!1),n.pipe([n.makeGetLatestBlock,function(t){return t.isSealed=e,n.Ok(t)}])},e.getTransactionStatus=function(e){return n.pipe([n.makeGetTransactionStatus,function(t){return t.txId=e,n.Ok(t)}])},e.limit=function(e){return n.pipe([function(t){return t.payload.limit=e,n.Ok(t)}])},e.param=function(e,n,t){return void 0===n&&(n=c),void 0===t&&(t=null),{key:t,value:e,xform:n}},e.params=function(e){return void 0===e&&(e=[]),n.pipe([n.put("ix.params",(t=e,void 0===t&&(t=[]),t.filter(function(e){return null!=e.key}).reduce(function(e,n){var t;return u({},e,((t={})[n.key]=n.value,t))},{})))]);var t},e.payer=function(e){return n.pipe([n.put("tx.payer",e)])},e.ping=function(){return n.pipe([n.makePing])},e.proposer=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];try{var o=function(){"object"==typeof t[0]&&(i=t[0]);var e=t[0],r=t[1],o=t[2];return n.pipe([function(t){return t.proposer=i||p(e,r,o),n.Ok(t)}])},i=null,a=function(){if("function"==typeof t[0])return Promise.resolve(t[0]()).then(function(e){i=e})}();return Promise.resolve(a&&a.then?a.then(o):o(a))}catch(e){return Promise.reject(e)}},e.ref=function(e){return n.pipe([function(t){return t.payload.ref=e,n.Ok(t)}])},e.resolve=a,e.resolveAuthorizations=function(e){try{if(!n.isTransaction(e))return Promise.resolve(n.Ok(e));var t=i.encodeTransactionPayload({script:e.payload.code,refBlock:e.payload.ref||null,gasLimit:e.payload.limit,proposalKey:{address:e.proposer.addr,keyId:e.proposer.keyId,sequenceNum:e.proposer.sequenceNum},payer:n.get(e,"tx.payer").acct,authorizers:n.get(e,"tx.authorizations").map(function(e){return e.acct})}),r=n.get(e,"tx.authorizations",[]).map(function(r){try{var o=function(){return r.acct===n.get(e,"tx.payer").acct?l(r.acct,null,r.keyId):Promise.resolve(r.signFn({message:t,addr:r.acct,keyId:r.keyId,roles:{proposer:e.proposer.addr===r.acct,authorizer:!0,payer:n.get(e,"tx.payer").acct===r.acct},interaction:e})).then(function(e){return l(r.acct,e.signature,r.keyId)})},i=function(){if("function"==typeof r)return Promise.resolve(r()).then(function(e){r=e})}();return Promise.resolve(i&&i.then?i.then(o):o())}catch(e){return Promise.reject(e)}});return Promise.resolve(Promise.all(r)).then(function(t){e.authz=t;var r=i.encodeTransactionEnvelope({script:e.payload.code,refBlock:e.payload.ref,gasLimit:e.payload.limit,proposalKey:{address:e.proposer.addr,keyId:e.proposer.keyId,sequenceNum:e.proposer.sequenceNum},payer:n.get(e,"tx.payer").acct,authorizers:n.get(e,"tx.authorizations").map(function(e){return e.acct}),payloadSigs:e.authz.map(function(e){return null===e.signature?null:{address:e.acct,keyId:e.keyId,sig:e.signature}}).filter(function(e){return null!==e})}),o=n.get(e,"tx.payer");return Promise.resolve(o.signFn({message:r,addr:o.acct,keyId:o.keyId,roles:{proposer:e.proposer.addr===o.acct,authorizer:!1,payer:!0},interaction:e})).then(function(t){return e.payer=l(o.acct,t.signature,o.keyId),n.Ok(e)})})}catch(e){return Promise.reject(e)}},e.resolveParams=y,e.script=function(){return n.pipe([n.makeScript,n.put("ix.code",o.t7l.apply(void 0,arguments))])},e.transaction=function(){return n.pipe([n.makeTransaction,n.put("ix.code",o.t7l.apply(void 0,arguments)),function(e){return e.payload.limit=e.payload.limit||10,e.payload.nonce=e.payload.nonce||d(),e.payload.ref=e.payload.ref||null,n.Ok(e)},n.update("tx.authorizations",f(s))])}});
//# sourceMappingURL=sdk.umd.js.map
