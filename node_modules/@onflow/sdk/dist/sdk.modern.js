import{pipe as r,interaction as n,put as e,makeGetAccount as t,Ok as o,makeGetEvents as u,makeGetLatestBlock as a,makeGetTransactionStatus as i,makePing as c,makeScript as s,makeTransaction as f,update as p,isTransaction as d,get as l,isScript as y}from"@onflow/interaction";export{isBad,isOk,pipe,why}from"@onflow/interaction";export{send}from"@onflow/send";export{decode,decodeResponse}from"@onflow/decode";import{t7l as m}from"@qvvg/templar";import{encodeTransactionPayload as v,encodeTransactionEnvelope as h}from"@onflow/encode";function k(e){return void 0===e&&(e=[]),r(n(),e)}var x=r;function g(n){return void 0===n&&(n=[]),r([e("tx.authorizations",n)])}function I(r,n,e){return{acct:r,signFn:n,keyId:e}}function P(n){return r([t,function(r){return r.acct=n,o(r)}])}function z(n,e,t){return r([u,function(r){return r.eventType=n,o(r)},function(r){return r.bounds.start=e,o(r)},function(r){return r.bounds.end=t,o(r)}])}function w(n){return void 0===n&&(n=!1),r([a,function(r){return r.isSealed=n,o(r)}])}function j(n){return r([i,function(r){return r.txId=n,o(r)}])}function q(n){return r([function(r){return r.payload.limit=n,o(r)}])}function b(){return(b=Object.assign||function(r){for(var n=1;n<arguments.length;n++){var e=arguments[n];for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(r[t]=e[t])}return r}).apply(this,arguments)}function N(n){return void 0===n&&(n=[]),r([e("ix.params",(t=n,void 0===t&&(t=[]),t.filter(function(r){return null!=r.key}).reduce(function(r,n){var e;return b({},r,((e={})[n.key]=n.value,e))},{})))]);var t}var O={asParam:function(r){return r},asInjection:function(r){return r}};function B(r,n,e){return void 0===n&&(n=O),void 0===e&&(e=null),{key:e,value:r,xform:n}}var F=function(){for(var n=arguments.length,e=new Array(n),t=0;t<n;t++)e[t]=arguments[t];try{var u=function(){"object"==typeof e[0]&&(a=e[0]);var n=e[0],t=e[1],u=e[2];return r([function(r){return r.proposer=a||K(n,t,u),o(r)}])},a=null,i=function(){if("function"==typeof e[0])return Promise.resolve(e[0]()).then(function(r){a=r})}();return Promise.resolve(i&&i.then?i.then(u):u(i))}catch(r){return Promise.reject(r)}};function K(r,n,e){return{addr:r,keyId:n,sequenceNum:e}}function L(n){return r([e("tx.payer",n)])}function S(){return r([c])}function A(n){return r([function(r){return r.payload.ref=n,o(r)}])}function D(){return r([s,e("ix.code",m.apply(void 0,arguments))])}var R=[];function T(){return Date.now()}function C(r){return function(n){return null==n?r:n}}function E(){return r([f,e("ix.code",m.apply(void 0,arguments)),function(r){return r.payload.limit=r.payload.limit||10,r.payload.nonce=r.payload.nonce||T(),r.payload.ref=r.payload.ref||null,o(r)},p("tx.authorizations",C(R))])}var G=function(r){try{if(!d(r))return Promise.resolve(o(r));var n=v({script:r.payload.code,refBlock:r.payload.ref||null,gasLimit:r.payload.limit,proposalKey:{address:r.proposer.addr,keyId:r.proposer.keyId,sequenceNum:r.proposer.sequenceNum},payer:l(r,"tx.payer").acct,authorizers:l(r,"tx.authorizations").map(function(r){return r.acct})}),e=l(r,"tx.authorizations",[]).map(function(e){try{var t=function(){return e.acct===l(r,"tx.payer").acct?H(e.acct,null,e.keyId):Promise.resolve(e.signFn({message:n,addr:e.acct,keyId:e.keyId,roles:{proposer:r.proposer.addr===e.acct,authorizer:!0,payer:l(r,"tx.payer").acct===e.acct},interaction:r})).then(function(r){return H(e.acct,r.signature,e.keyId)})},o=function(){if("function"==typeof e)return Promise.resolve(e()).then(function(r){e=r})}();return Promise.resolve(o&&o.then?o.then(t):t())}catch(r){return Promise.reject(r)}});return Promise.resolve(Promise.all(e)).then(function(n){r.authz=n;var e=h({script:r.payload.code,refBlock:r.payload.ref,gasLimit:r.payload.limit,proposalKey:{address:r.proposer.addr,keyId:r.proposer.keyId,sequenceNum:r.proposer.sequenceNum},payer:l(r,"tx.payer").acct,authorizers:l(r,"tx.authorizations").map(function(r){return r.acct}),payloadSigs:r.authz.map(function(r){return null===r.signature?null:{address:r.acct,keyId:r.keyId,sig:r.signature}}).filter(function(r){return null!==r})}),t=l(r,"tx.payer");return Promise.resolve(t.signFn({message:e,addr:t.acct,keyId:t.keyId,roles:{proposer:r.proposer.addr===t.acct,authorizer:!1,payer:!0},interaction:r})).then(function(n){return r.payer=H(t.acct,n.signature,t.keyId),o(r)})})}catch(r){return Promise.reject(r)}};function H(r,n,e){return{acct:r,signature:n,keyId:e}}var J=r([function(r){if(!d(r)&&!y(r))return o(r);var n=l(r,"ix.code");return r.payload.code="function"==typeof n?n(l(r,"ix.params",{})):n,o(r)}]);export{I as authorization,g as authorizations,k as build,P as getAccount,z as getEvents,w as getLatestBlock,j as getTransactionStatus,q as limit,B as param,N as params,L as payer,S as ping,F as proposer,A as ref,x as resolve,G as resolveAuthorizations,J as resolveParams,D as script,E as transaction};
//# sourceMappingURL=sdk.modern.js.map
