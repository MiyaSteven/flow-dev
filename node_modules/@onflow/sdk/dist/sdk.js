var e=require("@onflow/interaction"),r=require("@onflow/send"),t=require("@onflow/decode"),n=require("@qvvg/templar"),o=require("@onflow/encode"),i=e.pipe;function a(){return(a=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e}).apply(this,arguments)}var u={asParam:function(e){return e},asInjection:function(e){return e}};function c(e,r,t){return{addr:e,keyId:r,sequenceNum:t}}var p=[];function s(){return Date.now()}function d(e){return function(r){return null==r?e:r}}function f(e,r,t){return{acct:e,signature:r,keyId:t}}var l=e.pipe([function(r){if(!e.isTransaction(r)&&!e.isScript(r))return e.Ok(r);var t=e.get(r,"ix.code");return r.payload.code="function"==typeof t?t(e.get(r,"ix.params",{})):t,e.Ok(r)}]);Object.defineProperty(exports,"isBad",{enumerable:!0,get:function(){return e.isBad}}),Object.defineProperty(exports,"isOk",{enumerable:!0,get:function(){return e.isOk}}),Object.defineProperty(exports,"pipe",{enumerable:!0,get:function(){return e.pipe}}),Object.defineProperty(exports,"why",{enumerable:!0,get:function(){return e.why}}),Object.defineProperty(exports,"send",{enumerable:!0,get:function(){return r.send}}),Object.defineProperty(exports,"decode",{enumerable:!0,get:function(){return t.decode}}),Object.defineProperty(exports,"decodeResponse",{enumerable:!0,get:function(){return t.decodeResponse}}),exports.authorization=function(e,r,t){return{acct:e,signFn:r,keyId:t}},exports.authorizations=function(r){return void 0===r&&(r=[]),e.pipe([e.put("tx.authorizations",r)])},exports.build=function(r){return void 0===r&&(r=[]),e.pipe(e.interaction(),r)},exports.getAccount=function(r){return e.pipe([e.makeGetAccount,function(t){return t.acct=r,e.Ok(t)}])},exports.getEvents=function(r,t,n){return e.pipe([e.makeGetEvents,function(t){return t.eventType=r,e.Ok(t)},function(r){return r.bounds.start=t,e.Ok(r)},function(r){return r.bounds.end=n,e.Ok(r)}])},exports.getLatestBlock=function(r){return void 0===r&&(r=!1),e.pipe([e.makeGetLatestBlock,function(t){return t.isSealed=r,e.Ok(t)}])},exports.getTransactionStatus=function(r){return e.pipe([e.makeGetTransactionStatus,function(t){return t.txId=r,e.Ok(t)}])},exports.limit=function(r){return e.pipe([function(t){return t.payload.limit=r,e.Ok(t)}])},exports.param=function(e,r,t){return void 0===r&&(r=u),void 0===t&&(t=null),{key:t,value:e,xform:r}},exports.params=function(r){return void 0===r&&(r=[]),e.pipe([e.put("ix.params",(t=r,void 0===t&&(t=[]),t.filter(function(e){return null!=e.key}).reduce(function(e,r){var t;return a({},e,((t={})[r.key]=r.value,t))},{})))]);var t},exports.payer=function(r){return e.pipe([e.put("tx.payer",r)])},exports.ping=function(){return e.pipe([e.makePing])},exports.proposer=function(){for(var r=arguments.length,t=new Array(r),n=0;n<r;n++)t[n]=arguments[n];try{var o=function(){"object"==typeof t[0]&&(i=t[0]);var r=t[0],n=t[1],o=t[2];return e.pipe([function(t){return t.proposer=i||c(r,n,o),e.Ok(t)}])},i=null,a=function(){if("function"==typeof t[0])return Promise.resolve(t[0]()).then(function(e){i=e})}();return Promise.resolve(a&&a.then?a.then(o):o(a))}catch(e){return Promise.reject(e)}},exports.ref=function(r){return e.pipe([function(t){return t.payload.ref=r,e.Ok(t)}])},exports.resolve=i,exports.resolveAuthorizations=function(r){try{if(!e.isTransaction(r))return Promise.resolve(e.Ok(r));var t=o.encodeTransactionPayload({script:r.payload.code,refBlock:r.payload.ref||null,gasLimit:r.payload.limit,proposalKey:{address:r.proposer.addr,keyId:r.proposer.keyId,sequenceNum:r.proposer.sequenceNum},payer:e.get(r,"tx.payer").acct,authorizers:e.get(r,"tx.authorizations").map(function(e){return e.acct})}),n=e.get(r,"tx.authorizations",[]).map(function(n){try{var o=function(){return n.acct===e.get(r,"tx.payer").acct?f(n.acct,null,n.keyId):Promise.resolve(n.signFn({message:t,addr:n.acct,keyId:n.keyId,roles:{proposer:r.proposer.addr===n.acct,authorizer:!0,payer:e.get(r,"tx.payer").acct===n.acct},interaction:r})).then(function(e){return f(n.acct,e.signature,n.keyId)})},i=function(){if("function"==typeof n)return Promise.resolve(n()).then(function(e){n=e})}();return Promise.resolve(i&&i.then?i.then(o):o())}catch(e){return Promise.reject(e)}});return Promise.resolve(Promise.all(n)).then(function(t){r.authz=t;var n=o.encodeTransactionEnvelope({script:r.payload.code,refBlock:r.payload.ref,gasLimit:r.payload.limit,proposalKey:{address:r.proposer.addr,keyId:r.proposer.keyId,sequenceNum:r.proposer.sequenceNum},payer:e.get(r,"tx.payer").acct,authorizers:e.get(r,"tx.authorizations").map(function(e){return e.acct}),payloadSigs:r.authz.map(function(e){return null===e.signature?null:{address:e.acct,keyId:e.keyId,sig:e.signature}}).filter(function(e){return null!==e})}),i=e.get(r,"tx.payer");return Promise.resolve(i.signFn({message:n,addr:i.acct,keyId:i.keyId,roles:{proposer:r.proposer.addr===i.acct,authorizer:!1,payer:!0},interaction:r})).then(function(t){return r.payer=f(i.acct,t.signature,i.keyId),e.Ok(r)})})}catch(e){return Promise.reject(e)}},exports.resolveParams=l,exports.script=function(){return e.pipe([e.makeScript,e.put("ix.code",n.t7l.apply(void 0,arguments))])},exports.transaction=function(){return e.pipe([e.makeTransaction,e.put("ix.code",n.t7l.apply(void 0,arguments)),function(r){return r.payload.limit=r.payload.limit||10,r.payload.nonce=r.payload.nonce||s(),r.payload.ref=r.payload.ref||null,e.Ok(r)},e.update("tx.authorizations",d(p))])};
//# sourceMappingURL=sdk.js.map
